<div class="stats-container">
  <header class="stats-header">
    <button class="nav-btn" (click)="previousPeriod()">
      <span>‚Äπ</span>
    </button>
    <h2 class="title">{{ getDisplayTitle() }}</h2>
    <button class="nav-btn" (click)="nextPeriod()">
      <span>‚Ä∫</span>
    </button>
  </header>

  <!-- View Toggle -->
  <div class="view-toggle">
    <button 
      class="toggle-btn" 
      [class.active]="viewMode === 'attendances'"
      (click)="toggleView('attendances')">
      Attendances
    </button>
    <button 
      class="toggle-btn" 
      [class.active]="viewMode === 'workouts'"
      (click)="toggleView('workouts')">
      Workouts
    </button>
  </div>

  <!-- Attendances View -->
  <div class="attendances-view" *ngIf="viewMode === 'attendances'">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="stat-card primary">
        <div class="stat-icon">üìÖ</div>
        <div class="stat-content">
          <span class="stat-value">{{ monthlyCount }}</span>
          <span class="stat-label">This Month</span>
        </div>
      </div>
      <div class="stat-card secondary">
        <div class="stat-icon">üéØ</div>
        <div class="stat-content">
          <span class="stat-value">{{ yearlyCount }}</span>
          <span class="stat-label">This Year</span>
        </div>
      </div>
      <div class="stat-card tertiary">
        <div class="stat-icon">üèÜ</div>
        <div class="stat-content">
          <span class="stat-value">{{ totalCount }}</span>
          <span class="stat-label">All Time</span>
        </div>
      </div>
    </div>

    <!-- Yearly Chart -->
    <div class="chart-container">
      <h3 class="chart-title">Monthly Breakdown</h3>
      <div class="chart">
        <div class="chart-bar" *ngFor="let data of monthlyData">
          <div class="bar-container">
            <div 
              class="bar" 
              [style.height.%]="(data.count / getMaxCount()) * 100"
              [class.has-value]="data.count > 0">
              <span class="bar-value" *ngIf="data.count > 0">{{ data.count }}</span>
            </div>
          </div>
          <span class="bar-label">{{ data.month.substring(0, 3) }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Workouts View -->
  <div class="workouts-view" *ngIf="viewMode === 'workouts'">
    
    <!-- Monthly Workout Stats with Picker -->
    <div class="chart-container monthly-section">
      <div class="month-picker">
        <button class="nav-btn-small" (click)="prevWorkoutMonth()">‚Äπ</button>
        <h3 class="month-title">{{ monthNames[selectedWorkoutMonth] }} {{ currentYear }}</h3>
        <button class="nav-btn-small" (click)="nextWorkoutMonth()">‚Ä∫</button>
      </div>
      
      <div class="month-total">
        <span class="total-value">{{ getMonthlyWorkoutTotal() }}</span>
        <span class="total-label">workouts this month</span>
      </div>
      
      <div class="workout-type-list" *ngIf="monthlyWorkoutStats.length > 0">
        <div class="workout-type-item" *ngFor="let stat of monthlyWorkoutStats">
          <div class="type-info">
            <span class="type-icon">{{ stat.icon }}</span>
            <span class="type-name">{{ stat.name }}</span>
          </div>
          <div class="type-bar-container">
            <div 
              class="type-bar" 
              [style.width.%]="(stat.count / getMaxMonthlyWorkoutCount()) * 100"
              [style.background]="stat.color">
            </div>
          </div>
          <span class="type-count">{{ stat.count }}</span>
        </div>
      </div>

      <div class="no-data" *ngIf="monthlyWorkoutStats.length === 0">
        <p>No workouts in {{ monthNames[selectedWorkoutMonth] }}</p>
      </div>
    </div>

    <!-- Yearly Summary -->
    <div class="chart-container yearly-section">
      <h3 class="chart-title">{{ currentYear }} Total: {{ getTotalWorkouts() }} workouts</h3>
      
      <div class="workout-type-list compact" *ngIf="workoutTypeStats.length > 0">
        <div class="workout-type-item" *ngFor="let stat of workoutTypeStats">
          <div class="type-info">
            <span class="type-icon">{{ stat.icon }}</span>
            <span class="type-name">{{ stat.name }}</span>
          </div>
          <div class="type-bar-container">
            <div 
              class="type-bar" 
              [style.width.%]="(stat.count / getMaxWorkoutCount()) * 100"
              [style.background]="stat.color">
            </div>
          </div>
          <span class="type-count">{{ stat.count }}</span>
        </div>
      </div>

      <div class="no-data" *ngIf="workoutTypeStats.length === 0">
        <p>No workout data for {{ currentYear }}</p>
        <p class="hint">Start tracking workouts with types to see stats here!</p>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
  </div>
</div>
